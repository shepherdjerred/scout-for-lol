---
import AppLayout from "../../../layouts/app/AppLayout.astro";
---

<AppLayout title="Settings">
  <div class="p-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-white">Settings</h1>
      <p class="mt-2 text-slate-400">Manage your account and API tokens</p>
    </div>

    <!-- Settings Navigation -->
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <a
        href="/app/settings/tokens"
        class="flex items-center gap-4 rounded-xl border border-slate-800 bg-slate-900/50 p-6 transition-colors hover:border-slate-700 hover:bg-slate-900"
      >
        <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-amber-500/20">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
          </svg>
        </div>
        <div>
          <p class="font-medium text-white">API Tokens</p>
          <p class="text-sm text-slate-400">Manage tokens for desktop clients</p>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="ml-auto h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>

      <div class="flex items-center gap-4 rounded-xl border border-slate-800 bg-slate-900/50 p-6 opacity-50">
        <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-slate-700/50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
        </div>
        <div>
          <p class="font-medium text-slate-400">Notifications</p>
          <p class="text-sm text-slate-500">Coming soon</p>
        </div>
      </div>

      <div class="flex items-center gap-4 rounded-xl border border-slate-800 bg-slate-900/50 p-6 opacity-50">
        <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-slate-700/50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
        </div>
        <div>
          <p class="font-medium text-slate-400">Privacy</p>
          <p class="text-sm text-slate-500">Coming soon</p>
        </div>
      </div>
    </div>

    <!-- Account Info -->
    <div class="mt-8">
      <h2 class="mb-4 text-lg font-semibold text-white">Account</h2>
      <div class="rounded-xl border border-slate-800 bg-slate-900/50 p-6">
        <div class="flex items-center gap-4">
          <div id="account-avatar" class="h-16 w-16 rounded-full bg-slate-700"></div>
          <div>
            <p class="text-lg font-medium text-white" id="account-username">Loading...</p>
            <p class="text-sm text-slate-400" id="account-id">Discord ID: ...</p>
          </div>
        </div>
        <div class="mt-6 border-t border-slate-800 pt-6">
          <p class="text-sm text-slate-400">
            Member since <span id="account-created">...</span>
          </p>
        </div>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="mt-8">
      <h2 class="mb-4 text-lg font-semibold text-red-400">Danger Zone</h2>
      <div class="rounded-xl border border-red-500/30 bg-red-500/5 p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-white">Delete Account</p>
            <p class="text-sm text-slate-400">Permanently delete your account and all data</p>
          </div>
          <button
            class="rounded-lg border border-red-500/50 bg-transparent px-4 py-2 text-sm font-medium text-red-400 transition-colors hover:bg-red-500/10"
            disabled
          >
            Coming Soon
          </button>
        </div>
      </div>
    </div>
  </div>
</AppLayout>

<script>
import { getApiClient } from "../../../lib/trpc";

async function loadAccount() {
  try {
    const client = getApiClient();
    const user = await client.auth.me.query();

    const accountUsername = document.getElementById("account-username");
    const accountId = document.getElementById("account-id");
    const accountCreated = document.getElementById("account-created");
    const accountAvatar = document.getElementById("account-avatar");

    if (accountUsername) accountUsername.textContent = user.username;
    if (accountId) accountId.textContent = `Discord ID: ${user.discordId}`;
    if (accountCreated) {
      accountCreated.textContent = new Date(user.createdAt).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }
    if (accountAvatar && user.avatar) {
      const avatarUrl = `https://cdn.discordapp.com/avatars/${user.discordId}/${user.avatar}.png?size=128`;
      accountAvatar.style.backgroundImage = `url(${avatarUrl})`;
      accountAvatar.style.backgroundSize = "cover";
    }
  } catch (error) {
    console.error("Failed to load account:", error);
  }
}

loadAccount();
</script>
