---
import { Icon } from 'astro-icon/components';
import { iconColors, gradientColors, type ColorVariant } from '../lib/colors';

interface Props {
  title: string;
  description?: string;

  // Icon or number display
  icon?: string; // astro-icon name (e.g., "heroicons:check-circle")
  iconHtml?: string; // Raw HTML for custom icons
  number?: number;

  // Styling
  layout?: 'centered' | 'left';
  color?: ColorVariant;
  iconColor?: string; // Custom color class for icon background
  gradient?: string; // Gradient key from gradientColors

  // Container styling
  withCard?: boolean; // Wrap in card with shadow

  // For dt/dd usage (like FeatureCard)
  asList?: boolean;
}

const {
  title,
  description,
  icon,
  iconHtml,
  number,
  layout = 'centered',
  color = 'green',
  iconColor,
  gradient,
  withCard = false,
  asList = false,
} = Astro.props;

// Determine icon background color
const iconBgClass = iconColor ||
  (withCard && gradient ? `bg-linear-to-br ${gradientColors[gradient] || gradientColors.yellow}` :
   number ? 'bg-indigo-600 text-white' :
   iconColors[color]);

const containerClass = layout === 'centered' ? 'text-center' : asList ? 'relative pl-16' : 'flex flex-col';
const iconContainerClass = layout === 'centered' ? 'mx-auto' : asList ? 'absolute left-0 top-0' : '';
const iconSize = withCard ? 'w-24 h-24 mb-4' : number ? 'h-10 w-10' : 'h-12 w-12';
const iconInnerSize = withCard ? 'w-12 h-12' : 'h-6 w-6';
---

{withCard ? (
  <div class={containerClass}>
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-lg">
      <div class={`${iconSize} ${iconContainerClass} rounded-lg ${iconBgClass} flex items-center justify-center`}>
        {icon && <Icon name={icon} class={`${iconInnerSize} text-white`} />}
        {iconHtml && <div set:html={iconHtml} class={`${iconInnerSize} text-white`} />}
        {number && <span class="font-semibold text-white">{number}</span>}
      </div>
      <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">{title}</h4>
      {description && (
        <p class="text-gray-600 dark:text-gray-300">
          {description}
        </p>
      )}
    </div>
  </div>
) : asList ? (
  <div class={containerClass}>
    <dt class="text-base/7 font-semibold text-gray-900 dark:text-white">
      <div class={`${iconContainerClass} flex size-10 items-center justify-center rounded-lg ${iconBgClass}`}>
        {icon && <Icon name={icon} class="size-6 text-white" />}
        {iconHtml && <div set:html={iconHtml} class="size-6 text-white" />}
        {number && <span class="font-semibold">{number}</span>}
      </div>
      {title}
    </dt>
    {description && (
      <dd class="mt-2 text-base/7 text-gray-600 dark:text-gray-300">
        {description}
      </dd>
    )}
    <slot />
  </div>
) : number ? (
  <div class={containerClass}>
    <dt class="flex items-center gap-x-3 text-base/7 font-semibold text-gray-900 dark:text-white">
      <div class={`${iconSize} flex items-center justify-center rounded-lg ${iconBgClass} font-semibold`}>
        {number}
      </div>
      {title}
    </dt>
    {description && (
      <dd class="mt-4 flex flex-auto flex-col text-base/7 text-gray-600 dark:text-gray-300">
        <p class="flex-auto">
          {description}
        </p>
      </dd>
    )}
    <slot />
  </div>
) : (
  <div class={containerClass}>
    <div class={`${iconSize} ${iconContainerClass} flex items-center justify-center rounded-lg ${iconBgClass}`}>
      {icon && <Icon name={icon} class={iconInnerSize} />}
      {iconHtml && <div set:html={iconHtml} class={iconInnerSize} />}
    </div>
    <h3 class={`${layout === 'centered' ? 'mt-4' : 'mt-0'} text-lg font-semibold text-gray-900 dark:text-white`}>
      {title}
    </h3>
    {description && (
      <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
        {description}
      </p>
    )}
    <slot />
  </div>
)}
