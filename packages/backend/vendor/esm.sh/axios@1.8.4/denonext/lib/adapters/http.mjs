/* esm.sh - axios@1.8.4/lib/adapters/http */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import d from"../../unsafe/utils.mjs";import Y from"../../unsafe/core/settle.mjs";import qe from"../../unsafe/core/buildFullPath.mjs";import Me from"../../unsafe/helpers/buildURL.mjs";import $e from"/proxy-from-env@^1.1.0?target=denonext";import We from"node:http";import ve from"node:https";import Ve from"node:util";import Ye from"/follow-redirects@^1.15.6?target=denonext";import k from"node:zlib";var X="1.8.4";import Qe from"../defaults/transitional.mjs";import c from"../core/AxiosError.mjs";import Re from"../cancel/CanceledError.mjs";import ie from"../platform/index.mjs";import z from"../core/AxiosError.mjs";function j(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}import Ce from"../platform/index.mjs";var _e=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function ee(r,e,i){let s=i&&i.Blob||Ce.classes.Blob,t=j(r);if(e===void 0&&s&&(e=!0),t==="data"){r=t.length?r.slice(t.length+1):r;let l=_e.exec(r);if(!l)throw new z("Invalid URL",z.ERR_INVALID_URL);let o=l[1],p=l[2],u=l[3],h=__Buffer$.from(decodeURIComponent(u),p?"base64":"utf8");if(e){if(!s)throw new z("Blob is not supported",z.ERR_NOT_SUPPORT);return new s([h],{type:o})}return h}throw new z("Unsupported protocol "+t,z.ERR_NOT_SUPPORT)}import N from"node:stream";import ae from"../core/AxiosHeaders.mjs";import Ue from"node:stream";import ue from"../../unsafe/utils.mjs";var te=Symbol("internals"),re=class extends Ue.Transform{constructor(e){e=ue.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(s,t)=>!ue.isUndefined(t[s])),super({readableHighWaterMark:e.chunkSize});let i=this[te]={timeWindow:e.timeWindow,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null};this.on("newListener",s=>{s==="progress"&&(i.isCaptured||(i.isCaptured=!0))})}_read(e){let i=this[te];return i.onReadCallback&&i.onReadCallback(),super._read(e)}_transform(e,i,s){let t=this[te],l=t.maxRate,o=this.readableHighWaterMark,p=t.timeWindow,u=1e3/p,h=l/u,L=t.minChunkSize!==!1?Math.max(t.minChunkSize,h*.01):0,C=(f,m)=>{let w=__Buffer$.byteLength(f);t.bytesSeen+=w,t.bytes+=w,t.isCaptured&&this.emit("progress",t.bytesSeen),this.push(f)?__Process$.nextTick(m):t.onReadCallback=()=>{t.onReadCallback=null,__Process$.nextTick(m)}},P=(f,m)=>{let w=__Buffer$.byteLength(f),F=null,x=o,_,y=0;if(l){let U=Date.now();(!t.ts||(y=U-t.ts)>=p)&&(t.ts=U,_=h-t.bytes,t.bytes=_<0?-_:0,y=0),_=h-t.bytes}if(l){if(_<=0)return setTimeout(()=>{m(null,f)},p-y);_<x&&(x=_)}x&&w>x&&w-x>L&&(F=f.subarray(x),f=f.subarray(0,x)),C(f,F?()=>{__Process$.nextTick(m,null,F)}:m)};P(e,function f(m,w){if(m)return s(m);w?P(w,f):s(null)})}},se=re;import{EventEmitter as Ge}from"node:events";import ge from"node:util";import{Readable as ke}from"node:stream";import V from"../../unsafe/utils.mjs";var{asyncIterator:ce}=Symbol,De=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[ce]?yield*r[ce]():yield r},v=De;import fe from"../platform/index.mjs";var Pe=fe.ALPHABET.ALPHA_DIGIT+"-_",I=typeof TextEncoder=="function"?new TextEncoder:new ge.TextEncoder,g=`\r
`,Oe=I.encode(g),Fe=2,oe=class{constructor(e,i){let{escapeName:s}=this.constructor,t=V.isString(i),l=`Content-Disposition: form-data; name="${s(e)}"${!t&&i.name?`; filename="${s(i.name)}"`:""}${g}`;t?i=I.encode(String(i).replace(/\r?\n|\r\n?/g,g)):l+=`Content-Type: ${i.type||"application/octet-stream"}${g}`,this.headers=I.encode(l+g),this.contentLength=t?i.byteLength:i.size,this.size=this.headers.byteLength+this.contentLength+Fe,this.name=e,this.value=i}async*encode(){yield this.headers;let{value:e}=this;V.isTypedArray(e)?yield e:yield*v(e),yield Oe}static escapeName(e){return String(e).replace(/[\r\n"]/g,i=>({"\r":"%0D","\n":"%0A",'"':"%22"})[i])}},ze=(r,e,i)=>{let{tag:s="form-data-boundary",size:t=25,boundary:l=s+"-"+fe.generateString(t,Pe)}=i||{};if(!V.isFormData(r))throw TypeError("FormData instance required");if(l.length<1||l.length>70)throw Error("boundary must be 10-70 characters long");let o=I.encode("--"+l+g),p=I.encode("--"+l+"--"+g+g),u=p.byteLength,h=Array.from(r.entries()).map(([C,P])=>{let f=new oe(C,P);return u+=f.size,f});u+=o.byteLength*h.length,u=V.toFiniteNumber(u);let L={"Content-Type":`multipart/form-data; boundary=${l}`};return Number.isFinite(u)&&(L["Content-Length"]=u),e&&e(L),ke.from(async function*(){for(let C of h)yield o,yield*C.encode();yield p}())},pe=ze;import Ne from"node:stream";var ne=class extends Ne.Transform{__transform(e,i,s){this.push(e),s()}_transform(e,i,s){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let t=__Buffer$.alloc(2);t[0]=120,t[1]=156,this.push(t,i)}this.__transform(e,i,s)}},he=ne;import He from"../../unsafe/utils.mjs";var Ie=(r,e)=>He.isAsyncFn(r)?function(...i){let s=i.pop();r.apply(this,i).then(t=>{try{e?s(null,...e(t)):s(null,t)}catch(l){s(l)}},s)}:r,ye=Ie;import{progressEventReducer as be,progressEventDecorator as xe,asyncDecorator as Ee}from"../helpers/progressEventReducer.mjs";var we={flush:k.constants.Z_SYNC_FLUSH,finishFlush:k.constants.Z_SYNC_FLUSH},Ke={flush:k.constants.BROTLI_OPERATION_FLUSH,finishFlush:k.constants.BROTLI_OPERATION_FLUSH},Se=d.isFunction(k.createBrotliDecompress),{http:Ze,https:Je}=Ye,Xe=/https:?/,Te=ie.protocols.map(r=>r+":"),Be=(r,[e,i])=>(r.on("end",i).on("error",i),e);function je(r,e){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r,e)}function le(r,e,i){let s=e;if(!s&&s!==!1){let t=$e.getProxyForUrl(i);t&&(s=new URL(t))}if(s){if(s.username&&(s.auth=(s.username||"")+":"+(s.password||"")),s.auth){(s.auth.username||s.auth.password)&&(s.auth=(s.auth.username||"")+":"+(s.auth.password||""));let l=__Buffer$.from(s.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+l}r.headers.host=r.hostname+(r.port?":"+r.port:"");let t=s.hostname||s.host;r.hostname=t,r.host=t,r.port=s.port,r.path=i,s.protocol&&(r.protocol=s.protocol.includes(":")?s.protocol:`${s.protocol}:`)}r.beforeRedirects.proxy=function(l){le(l,e,l.href)}}var et=typeof __Process$<"u"&&d.kindOf(__Process$)==="process",tt=r=>new Promise((e,i)=>{let s,t,l=(u,h)=>{t||(t=!0,s&&s(u,h))},o=u=>{l(u),e(u)},p=u=>{l(u,!0),i(u)};r(o,p,u=>s=u).catch(p)}),rt=({address:r,family:e})=>{if(!d.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},Le=(r,e)=>rt(d.isObject(r)?r:{address:r,family:e}),Gt=et&&function(e){return tt(async function(s,t,l){let{data:o,lookup:p,family:u}=e,{responseType:h,responseEncoding:L}=e,C=e.method.toUpperCase(),P,f=!1,m;if(p){let a=ye(p,n=>d.isArray(n)?n:[n]);p=(n,b,O)=>{a(n,b,(R,D,Z)=>{if(R)return O(R);let A=d.isArray(D)?D.map(B=>Le(B)):[Le(D,Z)];b.all?O(R,A):O(R,A[0].address,A[0].family)})}}let w=new Ge,F=()=>{e.cancelToken&&e.cancelToken.unsubscribe(x),e.signal&&e.signal.removeEventListener("abort",x),w.removeAllListeners()};l((a,n)=>{P=!0,n&&(f=!0,F())});function x(a){w.emit("abort",!a||a.type?new Re(null,e,m):a)}w.once("abort",t),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(x),e.signal&&(e.signal.aborted?x():e.signal.addEventListener("abort",x)));let _=qe(e.baseURL,e.url,e.allowAbsoluteUrls),y=new URL(_,ie.hasBrowserEnv?ie.origin:void 0),U=y.protocol||Te[0];if(U==="data:"){let a;if(C!=="GET")return Y(s,t,{status:405,statusText:"method not allowed",headers:{},config:e});try{a=ee(e.url,h==="blob",{Blob:e.env&&e.env.Blob})}catch(n){throw c.from(n,c.ERR_BAD_REQUEST,e)}return h==="text"?(a=a.toString(L),(!L||L==="utf8")&&(a=d.stripBOM(a))):h==="stream"&&(a=N.Readable.from(a)),Y(s,t,{data:a,status:200,statusText:"OK",headers:new ae,config:e})}if(Te.indexOf(U)===-1)return t(new c("Unsupported protocol "+U,c.ERR_BAD_REQUEST,e));let T=ae.from(e.headers).normalize();T.set("User-Agent","axios/"+X,!1);let{onUploadProgress:Q,onDownloadProgress:G}=e,q=e.maxRate,M,$;if(d.isSpecCompliantForm(o)){let a=T.getContentType(/boundary=([-_\w\d]{10,70})/i);o=pe(o,n=>{T.set(n)},{tag:`axios-${X}-boundary`,boundary:a&&a[1]||void 0})}else if(d.isFormData(o)&&d.isFunction(o.getHeaders)){if(T.set(o.getHeaders()),!T.hasContentLength())try{let a=await Ve.promisify(o.getLength).call(o);Number.isFinite(a)&&a>=0&&T.setContentLength(a)}catch{}}else if(d.isBlob(o)||d.isFile(o))o.size&&T.setContentType(o.type||"application/octet-stream"),T.setContentLength(o.size||0),o=N.Readable.from(v(o));else if(o&&!d.isStream(o)){if(!__Buffer$.isBuffer(o))if(d.isArrayBuffer(o))o=__Buffer$.from(new Uint8Array(o));else if(d.isString(o))o=__Buffer$.from(o,"utf-8");else return t(new c("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",c.ERR_BAD_REQUEST,e));if(T.setContentLength(o.length,!1),e.maxBodyLength>-1&&o.length>e.maxBodyLength)return t(new c("Request body larger than maxBodyLength limit",c.ERR_BAD_REQUEST,e))}let Ae=d.toFiniteNumber(T.getContentLength());d.isArray(q)?(M=q[0],$=q[1]):M=$=q,o&&(Q||M)&&(d.isStream(o)||(o=N.Readable.from(o,{objectMode:!1})),o=N.pipeline([o,new se({maxRate:d.toFiniteNumber(M)})],d.noop),Q&&o.on("progress",Be(o,xe(Ae,be(Ee(Q),!1,3)))));let H;if(e.auth){let a=e.auth.username||"",n=e.auth.password||"";H=a+":"+n}if(!H&&y.username){let a=y.username,n=y.password;H=a+":"+n}H&&T.delete("authorization");let me;try{me=Me(y.pathname+y.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(a){let n=new Error(a.message);return n.config=e,n.url=e.url,n.exists=!0,t(n)}T.set("Accept-Encoding","gzip, compress, deflate"+(Se?", br":""),!1);let S={path:me,method:C,headers:T.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:H,protocol:U,family:u,beforeRedirect:je,beforeRedirects:{}};!d.isUndefined(p)&&(S.lookup=p),e.socketPath?S.socketPath=e.socketPath:(S.hostname=y.hostname.startsWith("[")?y.hostname.slice(1,-1):y.hostname,S.port=y.port,le(S,e.proxy,U+"//"+y.hostname+(y.port?":"+y.port:"")+S.path));let W,K=Xe.test(S.protocol);if(S.agent=K?e.httpsAgent:e.httpAgent,e.transport?W=e.transport:e.maxRedirects===0?W=K?ve:We:(e.maxRedirects&&(S.maxRedirects=e.maxRedirects),e.beforeRedirect&&(S.beforeRedirects.config=e.beforeRedirect),W=K?Je:Ze),e.maxBodyLength>-1?S.maxBodyLength=e.maxBodyLength:S.maxBodyLength=1/0,e.insecureHTTPParser&&(S.insecureHTTPParser=e.insecureHTTPParser),m=W.request(S,function(n){if(m.destroyed)return;let b=[n],O=+n.headers["content-length"];if(G||$){let B=new se({maxRate:d.toFiniteNumber($)});G&&B.on("progress",Be(B,xe(O,be(Ee(G),!0,3)))),b.push(B)}let R=n,D=n.req||m;if(e.decompress!==!1&&n.headers["content-encoding"])switch((C==="HEAD"||n.statusCode===204)&&delete n.headers["content-encoding"],(n.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":b.push(k.createUnzip(we)),delete n.headers["content-encoding"];break;case"deflate":b.push(new he),b.push(k.createUnzip(we)),delete n.headers["content-encoding"];break;case"br":Se&&(b.push(k.createBrotliDecompress(Ke)),delete n.headers["content-encoding"])}R=b.length>1?N.pipeline(b,d.noop):b[0];let Z=N.finished(R,()=>{Z(),F()}),A={status:n.statusCode,statusText:n.statusMessage,headers:new ae(n.headers),config:e,request:D};if(h==="stream")A.data=R,Y(s,t,A);else{let B=[],de=0;R.on("data",function(E){B.push(E),de+=E.length,e.maxContentLength>-1&&de>e.maxContentLength&&(f=!0,R.destroy(),t(new c("maxContentLength size of "+e.maxContentLength+" exceeded",c.ERR_BAD_RESPONSE,e,D)))}),R.on("aborted",function(){if(f)return;let E=new c("stream has been aborted",c.ERR_BAD_RESPONSE,e,D);R.destroy(E),t(E)}),R.on("error",function(E){m.destroyed||t(c.from(E,null,e,D))}),R.on("end",function(){try{let E=B.length===1?B[0]:__Buffer$.concat(B);h!=="arraybuffer"&&(E=E.toString(L),(!L||L==="utf8")&&(E=d.stripBOM(E))),A.data=E}catch(E){return t(c.from(E,null,e,A.request,A))}Y(s,t,A)})}w.once("abort",B=>{R.destroyed||(R.emit("error",B),R.destroy())})}),w.once("abort",a=>{t(a),m.destroy(a)}),m.on("error",function(n){t(c.from(n,null,e,m))}),m.on("socket",function(n){n.setKeepAlive(!0,1e3*60)}),e.timeout){let a=parseInt(e.timeout,10);if(Number.isNaN(a)){t(new c("error trying to parse `config.timeout` to int",c.ERR_BAD_OPTION_VALUE,e,m));return}m.setTimeout(a,function(){if(P)return;let b=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",O=e.transitional||Qe;e.timeoutErrorMessage&&(b=e.timeoutErrorMessage),t(new c(b,O.clarifyTimeoutError?c.ETIMEDOUT:c.ECONNABORTED,e,m)),x()})}if(d.isStream(o)){let a=!1,n=!1;o.on("end",()=>{a=!0}),o.once("error",b=>{n=!0,m.destroy(b)}),o.on("close",()=>{!a&&!n&&x(new Re("Request stream has been aborted",e,m))}),o.pipe(m)}else m.end(o)})},Kt=le;export{Kt as __setProxy,Gt as default};

import "https://deno.land/x/xhr@0.3.0/mod.ts";//# sourceMappingURL=http.mjs.map