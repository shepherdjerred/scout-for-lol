/* esm.sh - cron@4.1.4 */
import*as __0$ from"node:child_process";import*as __1$ from"/luxon@~3.6.0?target=denonext";var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({__esModule:true},m);switch(n){case"node:child_process":return e(__0$);case"luxon":return c(__1$);default:console.error('module "'+n+'" not found');return null;}};
var q=Object.create;var U=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var P=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var S=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var K=(r,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of G(e))!Z.call(r,o)&&o!==n&&U(r,o,{get:()=>e[o],enumerable:!(i=Y(e,o))||i.enumerable});return r};var B=(r,e,n)=>(n=r!=null?q(V(r)):{},K(e||!r||!r.__esModule?U(n,"default",{value:r,enumerable:!0}):n,r));var W=S(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.RE_RANGE=u.RE_WILDCARDS=u.PRESETS=u.TIME_UNITS_LEN=u.TIME_UNITS=u.TIME_UNITS_MAP=u.ALIASES=u.PARSE_DEFAULTS=u.CONSTRAINTS=void 0;u.CONSTRAINTS=Object.freeze({second:[0,59],minute:[0,59],hour:[0,23],dayOfMonth:[1,31],month:[1,12],dayOfWeek:[0,7]});u.PARSE_DEFAULTS=Object.freeze({second:"0",minute:"*",hour:"*",dayOfMonth:"*",month:"*",dayOfWeek:"*"});u.ALIASES=Object.freeze({jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6});u.TIME_UNITS_MAP=Object.freeze({SECOND:"second",MINUTE:"minute",HOUR:"hour",DAY_OF_MONTH:"dayOfMonth",MONTH:"month",DAY_OF_WEEK:"dayOfWeek"});u.TIME_UNITS=Object.freeze(Object.values(u.TIME_UNITS_MAP));u.TIME_UNITS_LEN=u.TIME_UNITS.length;u.PRESETS=Object.freeze({"@yearly":"0 0 0 1 1 *","@monthly":"0 0 0 1 * *","@weekly":"0 0 0 * * 0","@daily":"0 0 0 * * *","@hourly":"0 0 * * * *","@minutely":"0 * * * * *","@secondly":"* * * * * *","@weekdays":"0 0 0 * * 1-5","@weekends":"0 0 0 * * 0,6"});u.RE_WILDCARDS=/\*/g;u.RE_RANGE=/^(\d+)(?:-(\d+))?(?:\/(\d+))?$/g});var N=S(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.ExclusiveParametersError=O.CronError=void 0;var b=class extends Error{};O.CronError=b;var k=class extends b{constructor(e,n){super(`You can't specify both ${e} and ${n}`)}};O.ExclusiveParametersError=k});var D=S(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.CronTime=void 0;var m=P("luxon"),f=W(),d=N(),x=class r{constructor(e,n,i){if(this.realDate=!1,this.second={},this.minute={},this.hour={},this.dayOfMonth={},this.month={},this.dayOfWeek={},n!=null&&i!=null)throw new d.ExclusiveParametersError("timeZone","utcOffset");if(n){if(!m.DateTime.fromObject({},{zone:n}).isValid)throw new d.CronError("Invalid timezone.");this.timeZone=n}if(i!=null&&(this.utcOffset=i),n==null&&i==null){let o=Intl.DateTimeFormat().resolvedOptions().timeZone;this.timeZone=o}e instanceof Date||e instanceof m.DateTime?(this.source=e instanceof Date?m.DateTime.fromJSDate(e):e,this.realDate=!0):(this.source=e,this._parse(this.source))}static validateCronExpression(e){try{return new r(e),{valid:!0}}catch(n){return{valid:!1,error:n}}}_getWeekDay(e){return e.weekday===7?0:e.weekday}sendAt(e){let n=this.realDate&&this.source instanceof m.DateTime?this.source:m.DateTime.utc();if(this.timeZone&&(n=n.setZone(this.timeZone)),this.utcOffset!==void 0){let i=this.utcOffset<0?"-":"+",o=Math.trunc(this.utcOffset/60),t=String(Math.abs(o)).padStart(2,"0"),s=Math.abs(this.utcOffset-o*60),l=String(s).padStart(2,"0"),h=`UTC${i}${t}:${l}`;if(n=n.setZone(h),!n.isValid)throw new d.CronError("ERROR: You specified an invalid UTC offset.")}if(this.realDate){if(m.DateTime.local()>n)throw new d.CronError("WARNING: Date in past. Will never be fired.");return n}if(e===void 0||isNaN(e)||e<0)return this.getNextDateFrom(n);{let i=[];for(;e>0;e--)n=this.getNextDateFrom(n),i.push(n);return i}}getTimeout(){return Math.max(-1,this.sendAt().toMillis()-m.DateTime.utc().toMillis())}toString(){return this.toJSON().join(" ")}toJSON(){return f.TIME_UNITS.map(e=>this._wcOrAll(e))}getNextDateFrom(e,n){var i,o;e instanceof Date&&(e=m.DateTime.fromJSDate(e)),n?e=e.setZone(n):n=(i=e.zone.zoneName)!==null&&i!==void 0?i:e.zone.fixed;let t=m.DateTime.fromFormat(`${e.year}-${e.month}-${e.day} ${e.hour}:${e.minute}:${e.second}`,"yyyy-M-d H:m:s",{zone:"UTC"}),s=t.toMillis();if(this.realDate||t.millisecond>0&&(t=t.set({millisecond:0,second:t.second+1})),!t.isValid)throw new d.CronError("ERROR: You specified an invalid date.");let l=m.DateTime.now().plus({years:8});for(;;){if(t>l)throw new d.CronError(`Something went wrong. No execution date was found in the next 8 years.
							Please provide the following string if you would like to help debug:
							Time Zone: ${(o=n?.toString())!==null&&o!==void 0?o:'""'} - Cron String: ${this.source.toString()} - UTC offset: ${t.offset} - current Date: ${m.DateTime.local().toString()}`);if(!(t.month in this.month)&&Object.keys(this.month).length!==12){t=t.plus({month:1}),t=t.set({day:1,hour:0,minute:0,second:0});continue}if(!(t.day in this.dayOfMonth)&&Object.keys(this.dayOfMonth).length!==31&&!(this._getWeekDay(t)in this.dayOfWeek&&Object.keys(this.dayOfWeek).length!==7)||!(this._getWeekDay(t)in this.dayOfWeek)&&Object.keys(this.dayOfWeek).length!==7&&!(t.day in this.dayOfMonth&&Object.keys(this.dayOfMonth).length!==31)){t=t.plus({days:1}),t=t.set({hour:0,minute:0,second:0});continue}if(!(t.hour in this.hour)&&Object.keys(this.hour).length!==24){t=t.plus({hour:1}),t=t.set({minute:0,second:0});continue}if(!(t.minute in this.minute)&&Object.keys(this.minute).length!==60){t=t.plus({minute:1}),t=t.set({second:0});continue}if(t.toMillis()===s||!(t.second in this.second)&&Object.keys(this.second).length!==60){t=t.plus({second:1});continue}break}let h=t.hour,_=t.minute;t=m.DateTime.fromFormat(`${t.year}-${t.month}-${t.day} ${t.hour}:${t.minute}:${t.second}`,"yyyy-M-d H:m:s",{zone:n});let a=m.DateTime.fromFormat(`${t.year}-1-1 0:0:0`,"yyyy-M-d H:m:s",{zone:n});if((h!==t.hour||_!==t.minute)&&a.offset!==t.offset){for(;t.minus({minute:1}).offset!==a.offset;)t=t.minus({minute:1});return t}let c=t.minus({hour:1}),I=t.minus({hour:2});(c.hour===t.hour||I.hour===c.hour)&&c>e&&(t=c);let y=t.minus({minute:30});return(y.minute===t.minute||c.minute===y.minute)&&y>e&&(t=y),t}_wcOrAll(e){if(this._hasAll(e))return"*";let n=[];for(let i in this[e])n.push(i);return n.join(",")}_hasAll(e){let n=f.CONSTRAINTS[e],i=n[0],o=e===f.TIME_UNITS_MAP.DAY_OF_WEEK?n[1]-1:n[1];for(let t=i,s=o;t<s;t++)if(!(t in this[e]))return!1;return!0}_parse(e){var n;e=e.toLowerCase(),Object.keys(f.PRESETS).includes(e)&&(e=f.PRESETS[e]),e=e.replace(/[a-z]{1,3}/gi,t=>{if(Object.keys(f.ALIASES).includes(t))return f.ALIASES[t].toString();throw new d.CronError(`Unknown alias: ${t}`)});let i=e.trim().split(/\s+/);if(i.length<f.TIME_UNITS_LEN-1)throw new d.CronError("Too few fields");if(i.length>f.TIME_UNITS_LEN)throw new d.CronError("Too many fields");let o=i.length;for(let t of f.TIME_UNITS){let s=f.TIME_UNITS.indexOf(t),l=(n=i[s-(f.TIME_UNITS_LEN-o)])!==null&&n!==void 0?n:f.PARSE_DEFAULTS[t];this._parseField(l,t)}}_parseField(e,n){let i=this[n],o,t=f.CONSTRAINTS[n],s=t[0],l=t[1];e.split(",").forEach(a=>{let c=a.indexOf("*");if(c!==-1&&c!==0)throw new d.CronError(`Field (${a}) has an invalid wildcard expression`)}),e=e.replace(f.RE_WILDCARDS,`${s}-${l}`);let _=e.split(",");for(let a of _){let c=[...a.matchAll(f.RE_RANGE)][0];if(c?.[1]!==void 0){let[,I,y,v]=c,E=parseInt(I,10),w=y!==void 0?parseInt(y,10):void 0,J=v!==void 0,F=parseInt(v??"1",10);if(F===0)throw new d.CronError(`Field (${n}) has a step of zero`);if(w!==void 0&&E>w)throw new d.CronError(`Field (${n}) has an invalid range`);if(E<s||w!==void 0&&w>l||w===void 0&&E>l)throw new d.CronError(`Field value (${e}) is out of range`);E=Math.min(Math.max(s,~~Math.abs(E)),l),w!==void 0?w=Math.min(l,~~Math.abs(w)):w=J?l:E,o=E;do i[o]=!0,o+=F;while(o<=w);n==="dayOfWeek"&&(!i[0]&&i[7]&&(i[0]=i[7]),delete i[7])}else throw new d.CronError(`Field (${n}) cannot be parsed`)}}};p.CronTime=x});var z=S(C=>{"use strict";var g=C&&C.__awaiter||function(r,e,n,i){function o(t){return t instanceof n?t:new n(function(s){s(t)})}return new(n||(n=Promise))(function(t,s){function l(a){try{_(i.next(a))}catch(c){s(c)}}function h(a){try{_(i.throw(a))}catch(c){s(c)}}function _(a){a.done?t(a.value):o(a.value).then(l,h)}_((i=i.apply(r,e||[])).next())})};Object.defineProperty(C,"__esModule",{value:!0});C.CronJob=void 0;var L=P("node:child_process"),R=N(),M=D(),j=class r{get isActive(){return this._isActive}get isCallbackRunning(){return this._isCallbackRunning}constructor(e,n,i,o,t,s,l,h,_,a,c){if(this.unrefTimeout=!1,this.lastExecution=null,this.runOnce=!1,this.waitForCompletion=!1,this._isActive=!1,this._isCallbackRunning=!1,this._callbacks=[],this.context=s??this,this.waitForCompletion=!!a,this.errorHandler=c,t!=null&&h!=null)throw new R.ExclusiveParametersError("timeZone","utcOffset");t!=null?this.cronTime=new M.CronTime(e,t,null):h!=null?this.cronTime=new M.CronTime(e,null,h):this.cronTime=new M.CronTime(e,t,h),_!=null&&(this.unrefTimeout=_),i!=null&&(this.onComplete=this._fnWrap(i)),this.cronTime.realDate&&(this.runOnce=!0),this.addCallback(this._fnWrap(n)),l&&(this.lastExecution=new Date,this.fireOnTick()),o&&this.start()}static from(e){if(e.timeZone!=null&&e.utcOffset!=null)throw new R.ExclusiveParametersError("timeZone","utcOffset");return e.timeZone!=null?new r(e.cronTime,e.onTick,e.onComplete,e.start,e.timeZone,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout,e.waitForCompletion,e.errorHandler):e.utcOffset!=null?new r(e.cronTime,e.onTick,e.onComplete,e.start,null,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout,e.waitForCompletion,e.errorHandler):new r(e.cronTime,e.onTick,e.onComplete,e.start,e.timeZone,e.context,e.runOnInit,e.utcOffset,e.unrefTimeout,e.waitForCompletion,e.errorHandler)}_fnWrap(e){var n,i;switch(typeof e){case"function":return e;case"string":{let[o,...t]=e.split(" ");return L.spawn.bind(void 0,o??e,t,{})}case"object":return L.spawn.bind(void 0,e.command,(n=e.args)!==null&&n!==void 0?n:[],(i=e.options)!==null&&i!==void 0?i:{})}}addCallback(e){typeof e=="function"&&this._callbacks.push(e)}setTime(e){if(!(e instanceof M.CronTime))throw new R.CronError("time must be an instance of CronTime.");let n=this._isActive;this.stop(),this.cronTime=e,e.realDate&&(this.runOnce=!0),n&&this.start()}nextDate(){return this.cronTime.sendAt()}fireOnTick(){return g(this,void 0,void 0,function*(){if(!(this.waitForCompletion&&this._isCallbackRunning)){this._isCallbackRunning=!0;try{for(let e of this._callbacks){let n=e.call(this.context,this.onComplete);this.waitForCompletion&&(yield n)}}catch(e){this.errorHandler!=null?this.errorHandler(e):console.error("[Cron] error in callback",e)}finally{this._isCallbackRunning=!1}}})}nextDates(e){return this.cronTime.sendAt(e??0)}start(){if(this._isActive)return;let e=2147483647,n=this.cronTime.getTimeout(),i=0,o,t=l=>{o=Date.now(),this._timeout=setTimeout(s,l),this.unrefTimeout&&typeof this._timeout.unref=="function"&&this._timeout.unref()},s=()=>{let l=o+n-Date.now();if(l>0){let h=this.cronTime.getTimeout();h>l&&(h=l),i+=h}i?(i>e?(i-=e,n=e):(n=i,i=0),t(n)):(this.lastExecution=new Date,this._isActive=!1,this.runOnce||this.start(),this.fireOnTick())};n>=0?(this._isActive=!0,n>e&&(i=n-e,n=e),t(n)):this.stop()}lastDate(){return this.lastExecution}_executeOnComplete(){return g(this,void 0,void 0,function*(){if(typeof this.onComplete=="function")try{yield this.onComplete.call(this.context)}catch(e){console.error("[Cron] error in onComplete callback:",e)}})}_waitForJobCompletion(){return g(this,void 0,void 0,function*(){for(;this._isCallbackRunning;)yield new Promise(e=>setTimeout(e,100))})}stop(){if(this._timeout&&clearTimeout(this._timeout),this._isActive=!1,!this.waitForCompletion){this._executeOnComplete();return}Promise.resolve().then(()=>g(this,void 0,void 0,function*(){yield this._waitForJobCompletion(),yield this._executeOnComplete()}))}};C.CronJob=j});var H=S(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.validateCronExpression=T.timeout=T.sendAt=T.CronTime=T.CronJob=void 0;var $=D(),X=z();Object.defineProperty(T,"CronJob",{enumerable:!0,get:function(){return X.CronJob}});var Q=D();Object.defineProperty(T,"CronTime",{enumerable:!0,get:function(){return Q.CronTime}});var ee=r=>new $.CronTime(r).sendAt();T.sendAt=ee;var te=r=>new $.CronTime(r).getTimeout();T.timeout=te;T.validateCronExpression=$.CronTime.validateCronExpression});var A=B(H()),{__esModule:ce,validateCronExpression:ae,timeout:fe,sendAt:he,CronTime:de,CronJob:me}=A,Te=A.default??A;export{me as CronJob,de as CronTime,ce as __esModule,Te as default,he as sendAt,fe as timeout,ae as validateCronExpression};
//# sourceMappingURL=cron.mjs.map