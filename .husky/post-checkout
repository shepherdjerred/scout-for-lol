#!/bin/sh

# post-checkout hook
# Runs after git checkout and git worktree add
#
# Arguments:
#   $1 - ref of previous HEAD
#   $2 - ref of new HEAD
#   $3 - flag: 1 = branch checkout, 0 = file checkout

PREV_HEAD="$1"
NEW_HEAD="$2"
CHECKOUT_TYPE="$3"

# Only run on branch checkouts (not file checkouts)
if [ "$CHECKOUT_TYPE" != "1" ]; then
  exit 0
fi

# Check if this is a new worktree (previous HEAD is all zeros)
# This happens when running `git worktree add`
if [ "$PREV_HEAD" = "0000000000000000000000000000000000000000" ]; then
  echo "New worktree detected, running mise dev to set up environment..."
  mise run dev
fi
